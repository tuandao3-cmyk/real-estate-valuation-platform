{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Explainability Output Schema",
    "description": "Canonical schema for non-decisional explainability artifacts in the Advanced AVM system. This schema enforces descriptive-only, audit-safe explainability outputs.",
    "type": "object",
    "additionalProperties": false,
    "required": [
        "valuation_id",
        "model_id",
        "model_version",
        "explainability_bundle_version",
        "feature_contribution",
        "price_breakdown",
        "model_reasoning",
        "disclaimer",
        "generated_at"
    ],
    "properties": {
        "valuation_id": {
            "type": "string",
            "description": "Unique valuation dossier identifier. Used for audit linkage only."
        },
        "model_id": {
            "type": "string",
            "description": "Immutable model identifier as registered in model_registry.yaml."
        },
        "model_version": {
            "type": "string",
            "description": "Exact model version used to generate the explainability artifacts."
        },
        "explainability_bundle_version": {
            "type": "string",
            "description": "Version of the explainability schema bundle for backward compatibility."
        },
        "feature_contribution": {
            "type": "object",
            "description": "Descriptive feature contribution output. Feature influence is presented without implying causality or decision authority.",
            "additionalProperties": false,
            "required": [
                "method",
                "features"
            ],
            "properties": {
                "method": {
                    "type": "string",
                    "description": "Explainability method identifier (e.g. linear_contribution, rule_trace)."
                },
                "features": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": [
                            "feature_name",
                            "contribution_value",
                            "direction"
                        ],
                        "properties": {
                            "feature_name": {
                                "type": "string",
                                "description": "Canonical feature name from feature registry."
                            },
                            "contribution_value": {
                                "type": "number",
                                "description": "Numeric contribution indicator. Unitless and non-decisional."
                            },
                            "direction": {
                                "type": "string",
                                "enum": [
                                    "positive",
                                    "negative",
                                    "neutral"
                                ],
                                "description": "Directional indication only. Not magnitude judgement."
                            }
                        }
                    }
                }
            }
        },
        "price_breakdown": {
            "type": "object",
            "description": "Structured breakdown of indicative price components. Components are descriptive signals, not final values.",
            "additionalProperties": false,
            "required": [
                "components",
                "aggregation_note"
            ],
            "properties": {
                "components": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": [
                            "source",
                            "indicative_value"
                        ],
                        "properties": {
                            "source": {
                                "type": "string",
                                "description": "Source model or approach (e.g. hedonic, cost, income, comparable)."
                            },
                            "indicative_value": {
                                "type": "number",
                                "description": "Indicative numeric signal. Not a decision or recommendation."
                            }
                        }
                    }
                },
                "aggregation_note": {
                    "type": "string",
                    "description": "Human-readable note explaining aggregation logic at a high level, without formulas or decision claims."
                }
            }
        },
        "model_reasoning": {
            "type": "object",
            "description": "Narrative reasoning context to support human understanding.",
            "additionalProperties": false,
            "required": [
                "statements",
                "limitations"
            ],
            "properties": {
                "statements": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": [
                            "text",
                            "source"
                        ],
                        "properties": {
                            "text": {
                                "type": "string",
                                "description": "Neutral explanatory statement. No evaluative or prescriptive language."
                            },
                            "source": {
                                "type": "string",
                                "description": "Origin of the statement (e.g. model_metadata, feature_contribution)."
                            }
                        }
                    }
                },
                "limitations": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string",
                        "description": "Explicit model or data limitations."
                    }
                }
            }
        },
        "disclaimer": {
            "type": "string",
            "description": "Mandatory disclaimer clarifying non-decisional nature of explainability outputs."
        },
        "generated_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp when explainability bundle was generated."
        }
    }
}